[{"filePath":"C:\\Users\\ColeS\\Documents\\Python_Scripts\\Sibling_Helper\\parent-app\\src\\pages\\Home.tsx","messages":[{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":105,"column":16,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[3430,3444],"text":"Today&apos;s Quests"},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[3430,3444],"text":"Today&lsquo;s Quests"},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[3430,3444],"text":"Today&#39;s Quests"},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[3430,3444],"text":"Today&rsquo;s Quests"},"desc":"Replace with `&rsquo;`."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useHero } from '@state/hero';\nimport { useQuests } from '@state/quests';\nimport { useBoard } from '@state/board';\nimport QuestCard from '@components/QuestCard';\nimport ProgressBar from '@components/ProgressBar';\nimport { LoadingIndicator } from '@sibling-helper/shared';\n\ntype HomeProps = {\n  onNavigateToRewards: () => void;\n};\n\nconst Home = ({ onNavigateToRewards }: HomeProps) => {\n  const { hero, loading: heroLoading } = useHero();\n  const { loading: questsLoading } = useQuests();\n  \n  // For now, we'll use today's date and a default hero ID\n  // In a real app, we would get these from context or props\n  const today = new Date().toISOString().slice(0, 10);\n  const heroId = hero?.id || 'hero-1';\n  const { boardItems, loading: boardLoading, completeQuest } = useBoard(heroId, today);\n\n  if (heroLoading || questsLoading || boardLoading) {\n    return (\n      <div style={{ padding: 16 }}>\n        <LoadingIndicator label=\"Loading dashboard...\" />\n      </div>\n    );\n  }\n\n  // Calculate progression level (every 10 progression points for now)\n  const progressionLevel = Math.floor((hero?.progressionPoints || 0) / 10) + 1;\n  const pointsInCurrentLevel = (hero?.progressionPoints || 0) % 10;\n\n  return (\n    <section>\n      <header style={{ marginBottom: 24 }}>\n        <div style={{ display: 'flex', alignItems: 'center', gap: 12 }}>\n          <div style={{\n            width: 48,\n            height: 48,\n            borderRadius: 24,\n            backgroundColor: '#0ea5e9',\n            display: 'flex',\n            alignItems: 'center',\n            justifyContent: 'center',\n            color: 'white',\n            fontSize: 20,\n            fontWeight: 'bold'\n          }}>\n            {hero?.avatarUrl ? (\n              <img \n                src={hero.avatarUrl} \n                alt={hero.name} \n                style={{ \n                  width: '100%', \n                  height: '100%', \n                  borderRadius: '50%',\n                  objectFit: 'cover'\n                }} \n              />\n            ) : (\n              hero?.name.charAt(0)\n            )}\n          </div>\n          <div>\n            <h1 style={{ margin: 0, fontSize: 24 }}>{hero?.name}</h1>\n            <div style={{ fontSize: 14, opacity: 0.8 }}>Level {progressionLevel - 1}</div>\n          </div>\n        </div>\n        \n        <div style={{ marginTop: 16 }}>\n          <ProgressBar \n            current={pointsInCurrentLevel} \n            max={10} \n            label={`XP to Level ${progressionLevel}`} \n          />\n        </div>\n        \n        <div style={{ \n          marginTop: 8, \n          fontSize: 14,\n          display: 'flex',\n          justifyContent: 'space-between'\n        }}>\n          <span>Total XP: {hero?.progressionPoints || 0}</span>\n          <span>Reward Points: {hero?.rewardPoints || 0}</span>\n          <button \n            onClick={onNavigateToRewards}\n            style={{ \n              background: document.body.classList.contains('dark') ? '#1e293b' : 'none', \n              border: document.body.classList.contains('dark') ? '1px solid #334155' : 'none', \n              color: '#0ea5e9', \n              cursor: 'pointer',\n              textDecoration: 'underline',\n              padding: '6px 12px',\n              borderRadius: '6px',\n              fontWeight: '500'\n            }}\n          >\n            Reward Shop â†’\n          </button>\n        </div>\n      </header>\n      \n      <h2>Today's Quests</h2>\n      <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fill, minmax(220px, 1fr))', gap: 12 }}>\n        {boardItems.map((item) => (\n          <QuestCard \n            key={item.id}\n            title={item.quest?.title || 'Unknown Quest'}\n            points={item.quest?.points || 0}\n            completed={!!item.completedAt}\n            onComplete={() => completeQuest(item.id)}\n          />\n        ))}\n      </div>\n    </section>\n  );\n};\n\nexport default Home;\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\ColeS\\Documents\\Python_Scripts\\Sibling_Helper\\parent-app\\src\\pages\\Parent.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\ColeS\\Documents\\Python_Scripts\\Sibling_Helper\\parent-app\\src\\pages\\ParentMode.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":35,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":35,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2242,2245],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2242,2245],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":36,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":36,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2306,2309],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2306,2309],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":39,"column":79,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":39,"endColumn":82,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2550,2553],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2550,2553],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":67,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":67,"endColumn":17},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":107,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":107,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5121,5124],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5121,5124],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":149,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":149,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6362,6365],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6362,6365],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":221,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":221,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8390,8393],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8390,8393],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":236,"column":94,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":236,"endColumn":97,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8959,8962],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8959,8962],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":237,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":237,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9009,9012],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9009,9012],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":548,"column":22,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[19044,19090],"text":"\r\n                Child&apos;s Name\r\n              "},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[19044,19090],"text":"\r\n                Child&lsquo;s Name\r\n              "},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[19044,19090],"text":"\r\n                Child&#39;s Name\r\n              "},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[19044,19090],"text":"\r\n                Child&rsquo;s Name\r\n              "},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":595,"column":60,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[20785,20833],"text":"Choose a clear photo that shows the child&apos;s face"},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[20785,20833],"text":"Choose a clear photo that shows the child&lsquo;s face"},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[20785,20833],"text":"Choose a clear photo that shows the child&#39;s face"},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[20785,20833],"text":"Choose a clear photo that shows the child&rsquo;s face"},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":664,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":664,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[24166,24169],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[24166,24169],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":944,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":944,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[35739,35742],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[35739,35742],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":13,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useRef } from 'react';\r\nimport type { ChangeEvent } from 'react';\r\nimport { useHero } from '@state/hero';\r\nimport { useQuests } from '@state/quests';\r\nimport { useRewards } from '@state/rewards';\r\nimport { useLinkedChildren } from '@state/linkedChildren';\r\nimport RewardForm from '@components/RewardForm';\r\nimport Tasks from './Tasks';\r\nimport { pinManager } from '@state/pinManager';\r\nimport { LoadingIndicator, PointRequestApprovalPanel, linkingService, taskAssignmentService, useTheme } from '@sibling-helper/shared';\nimport type { Link } from '@sibling-helper/shared';\r\nimport LinkRequestToast from '@components/LinkRequestToast';\r\nimport { isValidPin, sanitizePinInput, sanitizeText } from '../utils/sanitize';\r\n\r\nconst ParentMode = () => {\r\n  const { hero, updateHero, loading: heroLoading, error: heroError, refreshHero } = useHero();\r\n  const { quests, error: questsError, refreshQuests } = useQuests();\r\n  const { rewards, addReward, updateReward, deleteReward, error: rewardsError, refreshRewards } = useRewards();\r\n  const { linkedChildren, linkChild, unlinkChild, updateChild } = useLinkedChildren();\r\n  const [activeTab, setActiveTab] = useState<'profile' | 'tasks' | 'rewards' | 'requests' | 'settings'>('profile');\r\n  const [editingReward, setEditingReward] = useState<string | null>(null);\r\n  const [showAddRewardModal, setShowAddRewardModal] = useState(false);\r\n  const [showLinkChildModal, setShowLinkChildModal] = useState(false);\r\n  const [newName, setNewName] = useState(hero?.name || '');\r\n  const [avatarPreview, setAvatarPreview] = useState<string | null>(null);\r\n  const [selectedAvatar, setSelectedAvatar] = useState<File | null>(null);\r\n  const [pinInput, setPinInput] = useState('');\r\n  const [pinError, setPinError] = useState('');\r\n  const [generatedCode, setGeneratedCode] = useState<string | null>(null);\r\n  const [linkMessage, setLinkMessage] = useState('');\r\n  const [linkError, setLinkError] = useState('');\r\n  const [linkRefresh, setLinkRefresh] = useState(0);\r\n  const [showUnlinkModal, setShowUnlinkModal] = useState(false);\r\n  const [unlinkTarget, setUnlinkTarget] = useState<{ childId: string; name: string } | null>(null);\r\n  const [toastQueue, setToastQueue] = useState<any[]>([]);\r\n  const [currentToast, setCurrentToast] = useState<any | null>(null);\r\n  const seenLinkIdsRef = useRef<Set<string>>(new Set());\r\n  const [assignmentsOpen, setAssignmentsOpen] = useState<Record<string, boolean>>({});\r\n  const [assignmentsByChild, setAssignmentsByChild] = useState<Record<string, any[]>>({});\r\n  const [assignmentsLoading, setAssignmentsLoading] = useState<Record<string, boolean>>({});\r\n  const [assignmentsError, setAssignmentsError] = useState<Record<string, string>>({});\r\n  const [manageOpenByChild, setManageOpenByChild] = useState<Record<string, boolean>>({});\r\n  const [pendingLinks, setPendingLinks] = useState<Link[]>([]);\r\n  const dataErrors = [heroError, questsError, rewardsError].filter(Boolean) as string[];\r\n  const { isDark, setMode } = useTheme();\r\n\r\n  const handleRetryData = async () => {\r\n    await refreshHero();\r\n    await refreshQuests();\r\n    await refreshRewards();\r\n  };\r\n\r\n  useEffect(() => {\r\n    const load = async () => {\r\n      if (!hero) return;\r\n      try {\r\n        const pending = (await linkingService.getPendingForParentRemote(hero.id)) as Link[];\r\n        setPendingLinks(pending);\r\n\r\n        // Detect new pending links for toast notifications\r\n        const seen = seenLinkIdsRef.current;\r\n        const newOnes = pending.filter((l) => !seen.has(l.id));\r\n        if (newOnes.length > 0) {\r\n          newOnes.forEach((l) => seen.add(l.id));\r\n          setToastQueue((q) => [...q, ...newOnes]);\r\n        }\r\n      } catch (e) {\r\n        // Fallback to local if remote fails\r\n        setPendingLinks(linkingService.getPendingForParent(hero.id));\r\n      }\r\n    };\r\n    load();\r\n  }, [hero, linkRefresh]);\r\n\r\n  // Update document title with pending count badge\r\n  useEffect(() => {\r\n    const base = 'Big Sibling Helper';\r\n    if (pendingLinks.length > 0) {\r\n      document.title = `(${pendingLinks.length}) ${base}`;\r\n    } else {\r\n      document.title = base;\r\n    }\r\n  }, [pendingLinks.length]);\r\n\r\n  // Poll for new link requests every 5 seconds when on parent mode\r\n  useEffect(() => {\r\n    const id = window.setInterval(() => setLinkRefresh((x) => x + 1), 5000);\r\n    return () => window.clearInterval(id);\r\n  }, []);\r\n\r\n  // Pop next toast when queue changes\r\n  useEffect(() => {\r\n    if (!currentToast && toastQueue.length > 0) {\r\n      setCurrentToast(toastQueue[0]);\r\n      setToastQueue((q) => q.slice(1));\r\n    }\r\n  }, [toastQueue, currentToast]);\r\n\r\n  const closeCurrentToast = () => setCurrentToast(null);\r\n  const loadAssignmentsForChild = async (childId: string) => {\r\n    if (!hero) return;\r\n    setAssignmentsLoading((s) => ({ ...s, [childId]: true }));\r\n    try {\r\n      const items = await taskAssignmentService.listForParentChild(hero.id, childId);\r\n      setAssignmentsByChild((m) => ({ ...m, [childId]: items }));\r\n      setAssignmentsError((e) => ({ ...e, [childId]: '' }));\r\n    } catch (e: any) {\r\n      setAssignmentsError((er) => ({ ...er, [childId]: e?.message || 'Failed to load assignments' }));\r\n    } finally {\r\n      setAssignmentsLoading((s) => ({ ...s, [childId]: false }));\r\n    }\r\n  };\r\n  \r\n  // Settings state\r\n  const [newPin, setNewPin] = useState('');\r\n  const [confirmPin, setConfirmPin] = useState('');\r\n  const [pinMessage, setPinMessage] = useState('');\r\n\r\n  // Handle route redirects\r\n  useEffect(() => {\r\n    const hash = window.location.hash;\r\n    \r\n    // Redirect legacy routes\r\n    if (hash === '#/quests') {\r\n      setActiveTab('tasks');\r\n      // Replace the URL without reloading\r\n      window.history.replaceState(null, '', '#/tasks');\r\n    } else if (hash === '#/chores') {\r\n      setActiveTab('tasks');\r\n      // Replace the URL without reloading and add view parameter\r\n      window.history.replaceState(null, '', '#/tasks?view=recurring');\r\n    }\r\n  }, []);\r\n\r\n  // Update when hero loads\r\n  useEffect(() => {\r\n    if (hero) {\r\n      setNewName(hero.name);\r\n    }\r\n  }, [hero]);\r\n\r\n  const handleSaveProfile = async () => {\r\n    if (!hero) return;\r\n    \r\n    try {\r\n      const safeName = sanitizeText(newName, 60);\r\n      if (!safeName) return;\r\n      setNewName(safeName);\r\n      const updates: any = { name: safeName };\r\n      \r\n      // If there's a new avatar, convert it to a data URL\r\n      if (selectedAvatar) {\r\n        const reader = new FileReader();\r\n        reader.onload = async (e) => {\r\n          const avatarUrl = e.target?.result as string;\r\n          await updateHero({ ...updates, avatarUrl });\r\n        };\r\n        reader.readAsDataURL(selectedAvatar);\r\n      } else {\r\n        await updateHero(updates);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error saving profile:', error);\r\n    }\r\n  };\r\n\r\n  const handleAvatarChange = (e: ChangeEvent<HTMLInputElement>) => {\r\n    if (e.target.files && e.target.files[0]) {\r\n      const file = e.target.files[0];\r\n      setSelectedAvatar(file);\r\n      \r\n      // Preview the avatar\r\n      const reader = new FileReader();\r\n      reader.onload = (e) => {\r\n        setAvatarPreview(e.target?.result as string);\r\n      };\r\n      reader.readAsDataURL(file);\r\n    }\r\n  };\r\n\r\n  const handleThemeChange = (nextDark: boolean) => {\r\n    setMode(nextDark ? 'dark' : 'light');\r\n  };\r\n\r\n  const handleChangePin = async () => {\r\n    if (!newPin || !confirmPin) {\r\n      setPinMessage('Please fill in all fields');\r\n      return;\r\n    }\r\n    \r\n    if (newPin !== confirmPin) {\r\n      setPinMessage('New PINs do not match');\r\n      return;\r\n    }\r\n    \r\n    if (!isValidPin(newPin)) {\r\n      setPinMessage('PIN must be 4 digits');\r\n      return;\r\n    }\r\n    \r\n    // Change PIN\r\n    const didSet = await pinManager.setPin(newPin);\r\n    if (!didSet) {\r\n      setPinMessage('PIN must be 4 digits');\r\n      return;\r\n    }\r\n    setPinMessage('PIN changed successfully!');\r\n    \r\n    // Clear form\r\n    setNewPin('');\r\n    setConfirmPin('');\r\n  };\r\n\r\n  const handleGenerateLinkCode = async () => {\r\n    if (!hero) return;\r\n    try {\r\n      const { code } = await linkingService.generateCodeForParentAsync(hero.id);\r\n      setGeneratedCode(code);\r\n      setLinkError('');\r\n      setLinkMessage('Share this code with your child. It expires in ~15 minutes.');\r\n    } catch (e: any) {\r\n      setLinkError(e?.message || 'Unable to generate code');\r\n      setLinkMessage('');\r\n    }\r\n  };\r\n\r\n  const approvePendingLink = async (linkId: string) => {\r\n    if (!hero) return;\r\n    const res = await linkingService.approveLinkAsParentAsync(hero.id, linkId);\r\n    if (!res.success) {\r\n      setLinkError(res.error || 'Failed to approve link');\r\n    } else {\r\n      setLinkError('');\r\n      // Also create a local linked child entry if not present\r\n      try {\r\n        const refreshed = await (linkingService.getActiveForParentRemote(hero.id) as Promise<any[]>);\r\n        const link = refreshed.find((l: any) => l.id === linkId);\r\n        if (link) {\r\n          await linkChild({\r\n            childId: link.childId,\r\n            name: `Child ${linkedChildren.length + 1}`,\r\n            currentPoints: 0,\r\n            pin: '******'\r\n          });\r\n        }\r\n      } catch {\r\n        const link = linkingService.getLink(linkId);\r\n        if (link) {\r\n        await linkChild({\r\n          childId: link.childId,\r\n          name: `Child ${linkedChildren.length + 1}`,\r\n          currentPoints: 0,\r\n          pin: '******'\r\n        });\r\n        }\r\n      }\r\n    }\r\n    setLinkRefresh((x) => x + 1);\r\n  };\r\n\r\n  const declinePendingLink = async (linkId: string) => {\r\n    try {\r\n      await linkingService.declineLinkAsync(linkId);\r\n    } finally {\r\n      setLinkRefresh((x) => x + 1);\r\n    }\r\n  };\r\n\r\n  const handleLinkChildSubmit = async () => {\r\n    // This flow is deprecated. Codes should be generated here and entered on the child device,\r\n    // then approved under Requests.\r\n    setPinError('Please generate a code in Settings and have your child enter it. Approve the request under Requests.');\r\n  };\r\n\r\n  if (heroLoading) {\n    return (\n      <div style={{ padding: 16 }}>\n        <LoadingIndicator label=\"Loading parent mode...\" />\n      </div>\n    );\n  }\n\r\n  return (\r\n    <div style={{ \r\n      backgroundColor: isDark ? '#0f172a' : '#ffffff',\r\n      color: isDark ? '#f8fafc' : '#000000',\r\n      minHeight: '100vh',\r\n      // Ensure edge-to-edge coverage\r\n      margin: 0,\r\n      padding: 0,\r\n      width: '100%',\r\n      // Add frame border that uses CSS variable\r\n      border: '1px solid var(--frame-border)'\r\n    }}>\r\n      <h1 style={{ \r\n        margin: 0, \r\n        color: isDark ? '#f8fafc' : '#000000',\r\n        backgroundColor: isDark ? '#0f172a' : '#ffffff'\r\n      }}>\r\n        Parent Mode\r\n      </h1>\r\n\r\n      {dataErrors.length > 0 && (\n        <div role=\"alert\" style={{ \n          border: '1px solid #ef4444',\n          backgroundColor: '#fee2e2',\n          color: '#7f1d1d',\n          padding: 12,\n          borderRadius: 8,\n          margin: '12px 16px'\n        }}>\n          <div style={{ fontWeight: 'bold', marginBottom: 8 }}>We ran into a data error</div>\n          <div style={{ fontSize: 13, marginBottom: 8 }}>\n            Try again, and if this keeps happening consider refreshing the app.\n          </div>\n          <div style={{ marginBottom: 12 }}>\n            {dataErrors.map((message, index) => (\n              <div key={`${message}-${index}`}>{message}</div>\n            ))}\n          </div>\r\n          <button\r\n            onClick={handleRetryData}\r\n            style={{\r\n              padding: '8px 12px',\r\n              borderRadius: 6,\r\n              border: '1px solid #ef4444',\r\n              background: '#ef4444',\r\n              color: '#ffffff',\r\n              cursor: 'pointer',\r\n              fontWeight: 'bold'\r\n            }}\r\n          >\r\n            Retry loading\r\n          </button>\r\n        </div>\r\n      )}\r\n      \r\n      {/* Scrollable header with tabs */}\r\n      <div style={{ \r\n        display: 'flex',\r\n        overflowX: 'auto',\r\n        gap: 16,\r\n        marginBottom: 24,\r\n        borderBottom: isDark ? '1px solid #334155' : '1px solid #ddd',\r\n        paddingBottom: 8,\r\n        scrollbarWidth: 'none', // Hide scrollbar for Firefox\r\n        backgroundColor: isDark ? '#0f172a' : '#ffffff'\r\n      }}>\r\n        <style>{`\r\n          /* Hide scrollbar for Chrome, Safari and Opera */\r\n          div::-webkit-scrollbar {\r\n            display: none;\r\n          }\r\n        `}</style>\r\n        <button\r\n          onClick={() => setActiveTab('profile')}\r\n          style={{\r\n            padding: '8px 16px',\r\n            borderTop: 'none',\r\n            borderLeft: 'none',\r\n            borderRight: 'none',\r\n            borderBottom: activeTab === 'profile' ? '2px solid #0ea5e9' : 'none',\r\n            background: 'none',\r\n            cursor: 'pointer',\r\n            whiteSpace: 'nowrap',\r\n            color: isDark ? '#f8fafc' : '#000000'\r\n          }}\r\n        >\r\n          Profile\r\n        </button>\r\n        <button\r\n          onClick={() => setActiveTab('tasks')}\r\n          style={{\r\n            padding: '8px 16px',\r\n            borderTop: 'none',\r\n            borderLeft: 'none',\r\n            borderRight: 'none',\r\n            borderBottom: activeTab === 'tasks' ? '2px solid #0ea5e9' : 'none',\r\n            background: 'none',\r\n            cursor: 'pointer',\r\n            whiteSpace: 'nowrap',\r\n            color: isDark ? '#f8fafc' : '#000000'\r\n          }}\r\n        >\r\n          Tasks\r\n        </button>\r\n        <button\r\n          onClick={() => setActiveTab('rewards')}\r\n          style={{\r\n            padding: '8px 16px',\r\n            borderTop: 'none',\r\n            borderLeft: 'none',\r\n            borderRight: 'none',\r\n            borderBottom: activeTab === 'rewards' ? '2px solid #0ea5e9' : 'none',\r\n            background: 'none',\r\n            cursor: 'pointer',\r\n            whiteSpace: 'nowrap',\r\n            color: isDark ? '#f8fafc' : '#000000'\r\n          }}\r\n        >\r\n          Rewards\r\n        </button>\r\n        <button\r\n          onClick={() => setActiveTab('requests')}\r\n          style={{\r\n            position: 'relative',\r\n            padding: '8px 16px',\r\n            borderTop: 'none',\r\n            borderLeft: 'none',\r\n            borderRight: 'none',\r\n            borderBottom: activeTab === 'requests' ? '2px solid #0ea5e9' : 'none',\r\n            background: 'none',\r\n            cursor: 'pointer',\r\n            whiteSpace: 'nowrap',\r\n            color: isDark ? '#f8fafc' : '#000000'\r\n          }}\r\n        >\r\n          <span role=\"img\" aria-label=\"Requests\" style={{ marginRight: 6 }}>!</span>\r\n          Requests\r\n          {pendingLinks.length > 0 && (\r\n            <span\r\n              aria-label={`${pendingLinks.length} pending link requests`}\r\n              style={{\r\n                position: 'absolute',\r\n                top: 2,\r\n                right: 4,\r\n                display: 'inline-flex',\r\n                alignItems: 'center',\r\n                justifyContent: 'center',\r\n                minWidth: 18,\r\n                height: 18,\r\n                padding: '0 6px',\r\n                borderRadius: 9999,\r\n                fontSize: 12,\r\n                fontWeight: 700,\r\n                background: '#ef4444',\r\n                color: 'white'\r\n              }}\r\n            >\r\n              {pendingLinks.length > 9 ? '9+' : pendingLinks.length}\r\n            </span>\r\n          )}\r\n        </button>\r\n        <button\r\n          onClick={() => setActiveTab('settings')}\r\n          style={{\r\n            padding: '8px 16px',\r\n            borderTop: 'none',\r\n            borderLeft: 'none',\r\n            borderRight: 'none',\r\n            borderBottom: activeTab === 'settings' ? '2px solid #0ea5e9' : 'none',\r\n            background: 'none',\r\n            cursor: 'pointer',\r\n            whiteSpace: 'nowrap',\r\n            color: isDark ? '#f8fafc' : '#000000'\r\n          }}\r\n        >\r\n          Settings\r\n        </button>\r\n      </div>\r\n\r\n      {activeTab === 'profile' && (\r\n        <section>\r\n          <h2 style={{ color: isDark ? '#f8fafc' : '#000000' }}>Child Profile</h2>\r\n          \r\n          <div style={{ \r\n            display: 'flex', \r\n            flexDirection: 'column', \r\n            alignItems: 'center',\r\n            gap: 16,\r\n            padding: 24,\r\n            border: isDark ? '1px solid #334155' : '1px solid #ddd',\r\n            borderRadius: 8,\r\n            marginBottom: 24,\r\n            backgroundColor: isDark ? '#1e293b' : 'white'\r\n          }}>\r\n            <div style={{ position: 'relative' }}>\r\n              <div style={{\r\n                width: 120,\r\n                height: 120,\r\n                borderRadius: 60,\r\n                backgroundColor: '#0ea5e9',\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                justifyContent: 'center',\r\n                color: 'white',\r\n                fontSize: 48,\r\n                fontWeight: 'bold'\r\n              }}>\r\n                {avatarPreview ? (\r\n                  <img \r\n                    src={avatarPreview} \r\n                    alt=\"Preview\" \r\n                    style={{ \r\n                      width: '100%', \r\n                      height: '100%', \r\n                      borderRadius: '50%',\r\n                      objectFit: 'cover'\r\n                    }} \r\n                  />\r\n                ) : hero?.avatarUrl ? (\r\n                  <img \r\n                    src={hero.avatarUrl} \r\n                    alt={hero.name} \r\n                    style={{ \r\n                      width: '100%', \r\n                      height: '100%', \r\n                      borderRadius: '50%',\r\n                      objectFit: 'cover'\r\n                    }} \r\n                  />\r\n                ) : (\r\n                  hero?.name.charAt(0)\r\n                )}\r\n              </div>\r\n              \r\n              <label \r\n                htmlFor=\"avatar-upload\" \r\n                style={{\r\n                  position: 'absolute',\r\n                  bottom: 0,\r\n                  right: 0,\r\n                  background: '#0ea5e9',\r\n                  color: 'white',\r\n                  width: 36,\r\n                  height: 36,\r\n                  borderRadius: 18,\r\n                  display: 'flex',\r\n                  alignItems: 'center',\r\n                  justifyContent: 'center',\r\n                  cursor: 'pointer',\r\n                  border: '2px solid white'\r\n                }}\r\n              >\r\n                Edit\r\n              </label>\r\n              <input\r\n                id=\"avatar-upload\"\r\n                type=\"file\"\r\n                accept=\"image/*\"\r\n                onChange={handleAvatarChange}\r\n                style={{ display: 'none' }}\r\n              />\r\n            </div>\r\n            \r\n            <div style={{ width: '100%', maxWidth: 300 }}>\r\n              <label style={{ display: 'block', marginBottom: 8, fontWeight: 'bold', color: isDark ? '#f8fafc' : '#000000' }}>\r\n                Child's Name\r\n              </label>\r\n              <input\r\n                type=\"text\"\r\n                value={newName}\r\n                onChange={(e) => setNewName(e.target.value)}\r\n                placeholder=\"Enter child's name\"\r\n                style={{\r\n                  width: '100%',\r\n                  padding: 12,\r\n                  border: isDark ? '1px solid #334155' : '1px solid #ddd',\r\n                  borderRadius: 8,\r\n                  fontSize: 16,\r\n                  backgroundColor: isDark ? '#0f172a' : 'white',\r\n                  color: isDark ? '#f8fafc' : '#000000'\r\n                }}\r\n              />\r\n              \r\n              <button\r\n                onClick={handleSaveProfile}\r\n                style={{\r\n                  marginTop: 16,\r\n                  padding: '12px 24px',\r\n                  background: '#0ea5e9',\r\n                  color: 'white',\r\n                  border: 'none',\r\n                  borderRadius: 8,\r\n                  cursor: 'pointer',\r\n                  fontWeight: 'bold',\r\n                  fontSize: 16,\r\n                  width: '100%'\r\n                }}\r\n              >\r\n                Save Profile\r\n              </button>\r\n            </div>\r\n          </div>\r\n          \r\n          <div style={{ \r\n            backgroundColor: isDark ? '#1e293b' : '#f0f9ff', \r\n            padding: 16, \r\n            borderRadius: 8,\r\n            border: isDark ? '1px solid #334155' : '1px solid #bae6fd'\r\n          }}>\r\n            <h3 style={{ color: isDark ? '#f8fafc' : '#000000' }}>Profile Tips</h3>\r\n            <ul style={{ color: isDark ? '#cbd5e1' : '#000000' }}>\r\n              <li>Use a friendly nickname that the child likes</li>\r\n              <li>Choose a clear photo that shows the child's face</li>\r\n              <li>The profile will be displayed in Kid Mode</li>\r\n            </ul>\r\n            {/* Link Child App (moved to bottom) */}\r\n            <div style={{ \r\n              padding: 20, \r\n              border: isDark ? '1px solid #334155' : '1px solid #ddd', \r\n              borderRadius: 8,\r\n              backgroundColor: isDark ? '#1e293b' : 'white'\r\n            }}>\r\n              <h3 style={{ color: isDark ? '#f8fafc' : '#000000' }}>Link Child App</h3>\r\n              <p style={{ color: isDark ? '#94a3b8' : '#64748b' }}>Generate a 6-digit code and have your child enter it on their device. You will still need to approve the request here.</p>\r\n              {generatedCode && (\r\n                <div style={{\r\n                  padding: 12,\r\n                  border: '1px dashed #0ea5e9',\r\n                  borderRadius: 8,\r\n                  marginBottom: 8,\r\n                  background: isDark ? '#0b1220' : '#f0f9ff'\r\n                }}>\r\n                  <div style={{ fontSize: 12, color: isDark ? '#94a3b8' : '#0369a1' }}>Share this code</div>\r\n                  <div style={{ fontSize: 28, letterSpacing: 6, fontWeight: 700 }}>{generatedCode}</div>\r\n                </div>\r\n              )}\r\n              {linkMessage && (\r\n                <div style={{ marginBottom: 8, fontSize: 12, color: isDark ? '#94a3b8' : '#64748b' }}>{linkMessage}</div>\r\n              )}\r\n              {linkError && (\r\n                <div style={{\r\n                  marginBottom: 12,\r\n                  padding: 12,\r\n                  border: '1px solid #ef4444',\r\n                  color: isDark ? '#fca5a5' : '#991b1b',\r\n                  background: isDark ? '#7f1d1d' : '#fee2e2',\r\n                  borderRadius: 8\r\n                }}>{linkError}</div>\r\n              )}\r\n              <div style={{ display: 'flex', gap: 8 }}>\r\n                <button\r\n                  onClick={handleGenerateLinkCode}\r\n                  style={{\r\n                    padding: '10px 16px',\r\n                    background: '#0ea5e9',\r\n                    color: 'white',\r\n                    border: 'none',\r\n                    borderRadius: 6,\r\n                    cursor: 'pointer',\r\n                    fontWeight: 600\r\n                  }}\r\n                >Generate Linking Code</button>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Assignment Tools (moved to bottom) */}\r\n            <div style={{ \r\n              padding: 20, \r\n              border: isDark ? '1px solid #334155' : '1px solid #ddd', \r\n              borderRadius: 8,\r\n              backgroundColor: isDark ? '#1e293b' : 'white'\r\n            }}>\r\n              <h3 style={{ color: isDark ? '#f8fafc' : '#000000' }}>Assignment Tools</h3>\r\n              <p style={{ color: isDark ? '#94a3b8' : '#64748b', marginTop: 0 }}>Backfill missing assignment details (title/points) for older assignments.</p>\r\n              <button\r\n                onClick={async () => {\r\n                  try {\r\n                    const map = Object.fromEntries(quests.map(q => [q.id, { title: q.title, points: q.points }]));\r\n                    const res = await taskAssignmentService.migrateSnapshots(map, true);\r\n                    alert(`Updated ${res.updated} assignment(s).`);\r\n                    setLinkRefresh(x => x + 1);\r\n                  } catch (e: any) {\r\n                    alert(e?.message || 'Migration failed');\r\n                  }\r\n                }}\r\n                style={{ padding: '8px 12px', background: '#0ea5e9', color: 'white', border: 'none', borderRadius: 6, cursor: 'pointer', fontWeight: 600 }}\r\n              >\r\n                Backfill Assignment Details\r\n              </button>\r\n            </div>\r\n\r\n          </div>\r\n        </section>\r\n      )}\r\n\r\n      {activeTab === 'tasks' && (\r\n        <Tasks isDarkMode={isDark} />\n      )}\r\n\r\n      {activeTab === 'rewards' && (\r\n        <section>\r\n          <div style={{ \r\n            display: 'flex', \r\n            justifyContent: 'space-between', \r\n            alignItems: 'center',\r\n            marginBottom: 24\r\n          }}>\r\n            <h2 style={{ color: isDark ? '#f8fafc' : '#000000', margin: 0 }}>\r\n              Rewards\r\n            </h2>\r\n            <button\r\n              onClick={() => setShowAddRewardModal(true)}\r\n              style={{\r\n                padding: '8px 16px',\r\n                background: '#0ea5e9',\r\n                color: 'white',\r\n                border: 'none',\r\n                borderRadius: 8,\r\n                cursor: 'pointer',\r\n                fontWeight: 'bold',\r\n                fontSize: 14\r\n              }}\r\n            >\r\n              Add Reward\r\n            </button>\r\n          </div>\r\n          \r\n          <div style={{ display: 'grid', gridTemplateColumns: '1fr', gap: 12 }}>\r\n            {rewards.map(reward => (\r\n              <div \r\n                key={reward.id} \r\n                style={{ \r\n                  padding: 16, \r\n                  border: isDark ? '1px solid #334155' : '1px solid #ddd', \r\n                  borderRadius: 8,\r\n                  display: 'flex',\r\n                  justifyContent: 'space-between',\r\n                  alignItems: 'center',\r\n                  backgroundColor: isDark ? '#1e293b' : 'white'\r\n                }}\r\n              >\r\n                <div>\r\n                  <strong style={{ color: isDark ? '#f8fafc' : '#000000' }}>{reward.title}</strong>\r\n                  <div style={{ color: isDark ? '#94a3b8' : '#64748b', marginTop: 4 }}>\r\n                    Cost: {reward.cost} pts\r\n                  </div>\r\n                  {reward.description && (\r\n                    <div style={{ color: isDark ? '#cbd5e1' : '#334155', marginTop: 4, fontSize: 14 }}>\r\n                      {reward.description}\r\n                    </div>\r\n                  )}\r\n                </div>\r\n                <div style={{ display: 'flex', gap: 8 }}>\r\n                  <button\r\n                    onClick={() => {\r\n                      setEditingReward(reward.id);\r\n                      setShowAddRewardModal(true);\r\n                    }}\r\n                    style={{\r\n                      padding: '4px 8px',\r\n                      border: isDark ? '1px solid #0ea5e9' : '1px solid #0ea5e9',\r\n                      background: isDark ? '#0f172a' : 'white',\r\n                      color: isDark ? '#38bdf8' : '#0ea5e9',\r\n                      borderRadius: 4,\r\n                      cursor: 'pointer'\r\n                    }}\r\n                  >\r\n                    Edit\r\n                  </button>\r\n                  <button\r\n                    onClick={() => deleteReward(reward.id)}\r\n                    style={{\r\n                      padding: '4px 8px',\r\n                      border: isDark ? '1px solid #ef4444' : '1px solid #ef4444',\r\n                      background: isDark ? '#0f172a' : 'white',\r\n                      color: isDark ? '#f87171' : '#ef4444',\r\n                      borderRadius: 4,\r\n                      cursor: 'pointer'\r\n                    }}\r\n                  >\r\n                    Delete\r\n                  </button>\r\n                </div>\r\n              </div>\r\n            ))}\r\n          </div>\r\n\r\n          {/* Add/Edit Reward Modal */}\r\n          {showAddRewardModal && (\r\n            <div style={{\r\n              position: 'fixed',\r\n              top: 0,\r\n              left: 0,\r\n              right: 0,\r\n              bottom: 0,\r\n              backgroundColor: 'rgba(0, 0, 0, 0.5)',\r\n              display: 'flex',\r\n              alignItems: 'center',\r\n              justifyContent: 'center',\r\n              zIndex: 1000\r\n            }}>\r\n              <div style={{\r\n                backgroundColor: isDark ? '#0f172a' : 'white',\r\n                padding: 24,\r\n                borderRadius: 8,\r\n                maxWidth: 500,\r\n                width: '90%',\r\n                maxHeight: '90vh',\r\n                overflowY: 'auto'\r\n              }}>\r\n                <h3 style={{ \r\n                  marginTop: 0, \r\n                  color: isDark ? '#f8fafc' : '#000000',\r\n                  marginBottom: 20\r\n                }}>\r\n                  {editingReward ? 'Edit Reward' : 'Add Reward'}\r\n                </h3>\r\n                \r\n                <RewardForm \r\n                  reward={editingReward ? rewards.find(r => r.id === editingReward) : undefined}\r\n                  onSave={async (rewardData) => {\r\n                    if (editingReward) {\r\n                      await updateReward(editingReward, rewardData);\r\n                    } else {\r\n                      await addReward(rewardData);\r\n                    }\r\n                    setEditingReward(null);\r\n                    setShowAddRewardModal(false);\r\n                  }}\r\n                  onCancel={() => {\r\n                    setEditingReward(null);\r\n                    setShowAddRewardModal(false);\r\n                  }}\r\n                />\r\n              </div>\r\n            </div>\r\n          )}\r\n        </section>\r\n      )}\r\n\r\n      {activeTab === 'requests' && (\r\n        <section>\r\n          <h2 style={{ color: isDark ? '#f8fafc' : '#000000' }}>Point Requests</h2>\r\n          <p>Review and approve point requests from your child.</p>\r\n      <PointRequestApprovalPanel />\r\n\r\n          <div style={{ marginTop: 32, paddingTop: 16, borderTop: isDark ? '1px solid #334155' : '1px solid #ddd' }}>\r\n            <h2 style={{ color: isDark ? '#f8fafc' : '#000000' }}>Link Requests</h2>\r\n            <p>Approve or decline pending link requests from a child device.</p>\r\n            {linkError && (\r\n              <div style={{\r\n                marginBottom: 12,\r\n                padding: 12,\r\n                border: '1px solid #ef4444',\r\n                color: isDark ? '#fca5a5' : '#991b1b',\r\n                background: isDark ? '#7f1d1d' : '#fee2e2',\r\n                borderRadius: 8\r\n              }}>{linkError}</div>\r\n            )}\r\n            {pendingLinks.length === 0 ? (\r\n              <div style={{ color: isDark ? '#94a3b8' : '#64748b' }}>No pending link requests.</div>\r\n            ) : (\r\n              <div style={{ display: 'grid', gap: 12 }}>\r\n                {pendingLinks.map((l) => (\r\n                  <div key={l.id} style={{\r\n                    display: 'flex',\r\n                    justifyContent: 'space-between',\r\n                    alignItems: 'center',\r\n                    padding: 12,\r\n                    border: isDark ? '1px solid #334155' : '1px solid #ddd',\r\n                    borderRadius: 8,\r\n                    background: isDark ? '#0f172a' : '#fff'\r\n                  }}>\r\n                    <div>\r\n                      <div style={{ fontWeight: 600 }}>Child request</div>\r\n                      <div style={{ fontSize: 12, color: isDark ? '#94a3b8' : '#64748b' }}>childId: {l.childId}</div>\r\n                    </div>\r\n                    <div style={{ display: 'flex', gap: 8 }}>\r\n                      <button onClick={() => approvePendingLink(l.id)} style={{ padding: '6px 10px', borderRadius: 6, border: '1px solid #16a34a', color: '#16a34a', background: 'transparent' }}>Approve</button>\r\n                      <button onClick={() => declinePendingLink(l.id)} style={{ padding: '6px 10px', borderRadius: 6, border: '1px solid #ef4444', color: '#ef4444', background: 'transparent' }}>Decline</button>\r\n                    </div>\r\n                  </div>\r\n                ))}\r\n              </div>\r\n            )}\r\n          </div>\r\n        </section>\r\n      )}\r\n\r\n      {activeTab === 'settings' && (\r\n        <section>\r\n          <h2 style={{ color: isDark ? '#f8fafc' : '#000000' }}>Settings</h2>\r\n            \r\n            {/* Theme Settings */}\r\n            <div style={{ \r\n              padding: 20, \r\n              border: isDark ? '1px solid #334155' : '1px solid #ddd', \r\n              borderRadius: 8,\r\n              backgroundColor: isDark ? '#1e293b' : 'white',\r\n              display: 'none'\r\n            }}>\r\n              <h3 style={{ color: isDark ? '#f8fafc' : '#000000' }}>Link Child App</h3>\r\n              <p style={{ color: isDark ? '#94a3b8' : '#64748b' }}>Generate a 6-digit code and have your child enter it on their device. You will still need to approve the request here.</p>\r\n              {generatedCode && (\r\n                <div style={{\r\n                  padding: 12,\r\n                  border: '1px dashed #0ea5e9',\r\n                  borderRadius: 8,\r\n                  marginBottom: 8,\r\n                  background: isDark ? '#0b1220' : '#f0f9ff'\r\n                }}>\r\n                  <div style={{ fontSize: 12, color: isDark ? '#94a3b8' : '#0369a1' }}>Share this code</div>\r\n                  <div style={{ fontSize: 28, letterSpacing: 6, fontWeight: 700 }}>{generatedCode}</div>\r\n                </div>\r\n              )}\r\n              {linkMessage && (\r\n                <div style={{ marginBottom: 8, fontSize: 12, color: isDark ? '#94a3b8' : '#64748b' }}>{linkMessage}</div>\r\n              )}\r\n              {linkError && (\r\n                <div style={{\r\n                  marginBottom: 12,\r\n                  padding: 12,\r\n                  border: '1px solid #ef4444',\r\n                  color: isDark ? '#fca5a5' : '#991b1b',\r\n                  background: isDark ? '#7f1d1d' : '#fee2e2',\r\n                  borderRadius: 8\r\n                }}>{linkError}</div>\r\n              )}\r\n              <div style={{ display: 'flex', gap: 8 }}>\r\n                <button\r\n                  onClick={handleGenerateLinkCode}\r\n                  style={{\r\n                    padding: '10px 16px',\r\n                    background: '#0ea5e9',\r\n                    color: 'white',\r\n                    border: 'none',\r\n                    borderRadius: 6,\r\n                    cursor: 'pointer',\r\n                    fontWeight: 600\r\n                  }}\r\n                >Generate Linking Code</button>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Appearance */}\r\n            <div style={{ \r\n              padding: 20, \r\n              border: isDark ? '1px solid #334155' : '1px solid #ddd', \r\n              borderRadius: 8,\r\n              backgroundColor: isDark ? '#1e293b' : 'white',\r\n              display: 'none'\r\n            }}>\r\n              <h3 style={{ color: isDark ? '#f8fafc' : '#000000' }}>Assignment Tools</h3>\r\n              <p style={{ color: isDark ? '#94a3b8' : '#64748b', marginTop: 0 }}>Backfill missing assignment details (title/points) for older assignments.</p>\r\n              <button\r\n                onClick={async () => {\r\n                  try {\r\n                    const map = Object.fromEntries(quests.map(q => [q.id, { title: q.title, points: q.points }]));\r\n                    const res = await taskAssignmentService.migrateSnapshots(map, true);\r\n                    alert(`Updated ${res.updated} assignment(s).`);\r\n                    setLinkRefresh(x => x + 1);\r\n                  } catch (e: any) {\r\n                    alert(e?.message || 'Migration failed');\r\n                  }\r\n                }}\r\n                style={{ padding: '8px 12px', background: '#0ea5e9', color: 'white', border: 'none', borderRadius: 6, cursor: 'pointer', fontWeight: 600, marginBottom: 12 }}\r\n              >\r\n                Backfill Assignment Details\r\n              </button>\r\n            </div>\r\n\r\n            <div style={{ \r\n              padding: 20, \r\n              border: isDark ? '1px solid #334155' : '1px solid #ddd', \r\n              borderRadius: 8,\r\n              backgroundColor: isDark ? '#1e293b' : 'white'\r\n            }}>\r\n              <h3 style={{ color: isDark ? '#f8fafc' : '#000000' }}>Appearance</h3>\r\n              <div style={{ \r\n                display: 'flex', \r\n                justifyContent: 'space-between', \r\n                alignItems: 'center',\r\n                marginBottom: 16\r\n              }}>\r\n                <div>\r\n                  <div style={{ fontWeight: 'bold', color: isDark ? '#f8fafc' : '#000000' }}>Dark Mode</div>\r\n                  <div style={{ fontSize: 14, color: isDark ? '#94a3b8' : '#64748b' }}>\r\n                    Enable dark theme for better nighttime viewing\r\n                  </div>\r\n                </div>\r\n                <label style={{ position: 'relative', display: 'inline-block', width: 60, height: 34 }}>\r\n                  <input\r\n                    type=\"checkbox\"\r\n                    checked={isDark}\r\n                    onChange={(e) => handleThemeChange(e.target.checked)}\r\n                    style={{ opacity: 0, width: 0, height: 0 }}\r\n                  />\r\n                  <span style={{\r\n                    position: 'absolute',\r\n                    cursor: 'pointer',\r\n                    top: 0,\r\n                    left: 0,\r\n                    right: 0,\r\n                    bottom: 0,\r\n                    backgroundColor: isDark ? '#0ea5e9' : '#ccc',\r\n                    transition: '.4s',\r\n                    borderRadius: 34\r\n                  }}></span>\r\n                  <span style={{\r\n                    position: 'absolute',\r\n                    content: '',\r\n                    height: 26,\r\n                    width: 26,\r\n                    left: 4,\r\n                    bottom: 4,\r\n                    backgroundColor: 'white',\r\n                    transition: '.4s',\r\n                    borderRadius: '50%',\r\n                    transform: isDark ? 'translateX(26px)' : 'translateX(0)'\r\n                  }}></span>\r\n                </label>\r\n              </div>\r\n              \r\n              {/* Border Color Setting */}\r\n              <div style={{ \r\n                display: 'flex', \r\n                justifyContent: 'space-between', \r\n                alignItems: 'center',\r\n                marginBottom: 16\r\n              }}>\r\n                <div>\r\n                  <div style={{ fontWeight: 'bold', color: isDark ? '#f8fafc' : '#000000' }}>Border Color</div>\r\n                  <div style={{ fontSize: 14, color: isDark ? '#94a3b8' : '#64748b' }}>\r\n                    Customize the outer frame border color\r\n                  </div>\r\n                </div>\r\n                <select\r\n                  value={localStorage.getItem('borderColor') || 'system'}\r\n                  onChange={(e) => {\r\n                    localStorage.setItem('borderColor', e.target.value);\r\n                    // Apply border color change\r\n                    const borderColor = e.target.value === 'system' \r\n                      ? (isDark ? '#000000' : '#ffffff')\r\n                      : e.target.value;\r\n                    document.documentElement.style.setProperty('--frame-border', borderColor);\r\n                  }}\r\n                  style={{\r\n                    padding: '6px 12px',\r\n                    border: isDark ? '1px solid #334155' : '1px solid #ddd',\r\n                    borderRadius: 6,\r\n                    background: isDark ? '#0f172a' : 'white',\r\n                    color: isDark ? '#f8fafc' : '#000000'\r\n                  }}\r\n                >\r\n                  <option value=\"system\">System default</option>\r\n                  <option value=\"#000000\">Slate</option>\r\n                  <option value=\"#374151\">Graphite</option>\r\n                  <option value=\"#312e81\">Indigo</option>\r\n                  <option value=\"#065f46\">Emerald</option>\r\n                  <option value=\"#991b1b\">Rose</option>\r\n                </select>\r\n              </div>\r\n            </div>\r\n            \r\n            {/* Linked Children */}\r\n            <div style={{ \r\n              padding: 20, \r\n              border: isDark ? '1px solid #334155' : '1px solid #ddd', \r\n              borderRadius: 8,\r\n              backgroundColor: isDark ? '#1e293b' : 'white',\r\n              marginTop: 24\r\n            }}>\r\n              <div style={{ \r\n                display: 'flex', \r\n                justifyContent: 'space-between', \r\n                alignItems: 'center',\r\n                marginBottom: 16\r\n              }}>\r\n                <h3 style={{ color: isDark ? '#f8fafc' : '#000000', margin: 0 }}>Linked Children</h3>\r\n                <button\r\n                  onClick={() => setShowLinkChildModal(true)}\r\n                  style={{\r\n                    padding: '6px 12px',\r\n                    background: '#0ea5e9',\r\n                    color: 'white',\r\n                    border: 'none',\r\n                    borderRadius: 4,\r\n                    cursor: 'pointer',\r\n                    fontSize: 14\r\n                  }}\r\n                >\r\n                  Link New Child\r\n                </button>\r\n              </div>\r\n              \r\n              {linkedChildren.length === 0 ? (\r\n        <div style={{\r\n          textAlign: 'center',\r\n          padding: 24,\r\n          color: isDark ? '#94a3b8' : '#64748b'\r\n        }}>\r\n          No linked children yet.\r\n        </div>\r\n      ) : (\r\n        <div style={{ display: 'grid', gap: 12 }}>\r\n          {linkedChildren.map((child) => {\r\n            const manageOpen = !!manageOpenByChild[child.childId];\r\n            const assignmentsVisible = !!assignmentsOpen[child.childId];\r\n            const assignments = assignmentsByChild[child.childId] || [];\r\n\r\n            return (\r\n              <div\r\n                key={child.childId}\r\n                style={{\r\n                  padding: 12,\r\n                  border: isDark ? '1px solid #334155' : '1px solid #ddd',\r\n                  borderRadius: 6,\r\n                  backgroundColor: isDark ? '#0f172a' : '#f8fafc'\r\n                }}\r\n              >\r\n                <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between' }}>\r\n                  <div style={{ display: 'flex', alignItems: 'center', gap: 12 }}>\r\n                    <div\r\n                      style={{\r\n                        width: 40,\r\n                        height: 40,\r\n                        borderRadius: 20,\r\n                        backgroundColor: '#0ea5e9',\r\n                        display: 'flex',\r\n                        alignItems: 'center',\r\n                        justifyContent: 'center',\r\n                        color: 'white',\r\n                        fontWeight: 'bold'\r\n                      }}\r\n                    >\r\n                      {child.name.charAt(0)}\r\n                    </div>\r\n                    <div>\r\n                      <div\r\n                        style={{\r\n                          fontWeight: 'bold',\r\n                          color: isDark ? '#f8fafc' : '#000000'\r\n                        }}\r\n                      >\r\n                        {child.name}\r\n                      </div>\r\n                      <div\r\n                        style={{\r\n                          fontSize: 14,\r\n                          color: isDark ? '#94a3b8' : '#64748b'\r\n                        }}\r\n                      >\r\n                        {child.currentPoints} points\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                  <div style={{ display: 'flex', gap: 8 }}>\r\n                    <button\r\n                      onClick={() => {\r\n                        const open = !manageOpenByChild[child.childId];\r\n                        setManageOpenByChild((m) => ({ ...m, [child.childId]: open }));\r\n                      }}\r\n                      style={{\r\n                        padding: '6px 10px',\r\n                        border: isDark ? '1px solid #334155' : '1px solid #ddd',\r\n                        background: isDark ? '#0f172a' : 'white',\r\n                        color: isDark ? '#cbd5e1' : '#374151',\r\n                        borderRadius: 6,\r\n                        cursor: 'pointer',\r\n                        fontSize: 12,\r\n                        minWidth: 88\r\n                      }}\r\n                    >\r\n                      {manageOpen ? 'Close' : 'Manage'}\r\n                    </button>\r\n                  </div>\r\n                </div>\r\n\r\n                {manageOpen && (\r\n                  <div\r\n                    style={{\r\n                      marginTop: 8,\r\n                      paddingTop: 8,\r\n                      borderTop: isDark ? '1px solid #334155' : '1px solid #e5e7eb',\r\n                      display: 'flex',\r\n                      flexWrap: 'wrap',\r\n                      gap: 8\r\n                    }}\r\n                  >\r\n                    <button\r\n                      onClick={() => {\r\n                        const newName = prompt('Enter new name:', child.name);\r\n                        const safeName = newName ? sanitizeText(newName, 60) : '';\r\n                        if (safeName && safeName !== child.name) {\r\n                          updateChild(child.childId, { name: safeName });\r\n                        }\r\n                      }}\r\n                      style={{\r\n                        padding: '6px 10px',\r\n                        border: '1px solid #0ea5e9',\r\n                        background: isDark ? '#0f172a' : 'white',\r\n                        color: isDark ? '#38bdf8' : '#0ea5e9',\r\n                        borderRadius: 6,\r\n                        cursor: 'pointer',\r\n                        fontSize: 12\r\n                      }}\r\n                    >\r\n                      Rename\r\n                    </button>\r\n                    <button\r\n                      onClick={async () => {\r\n                        const open = !assignmentsOpen[child.childId];\r\n                        setAssignmentsOpen((m) => ({ ...m, [child.childId]: open }));\r\n                        if (open) await loadAssignmentsForChild(child.childId);\r\n                      }}\r\n                      style={{\r\n                        padding: '6px 10px',\r\n                        border: isDark ? '1px solid #334155' : '1px solid #ddd',\r\n                        background: isDark ? '#0f172a' : 'white',\r\n                        color: isDark ? '#cbd5e1' : '#374151',\r\n                        borderRadius: 6,\r\n                        cursor: 'pointer',\r\n                        fontSize: 12\r\n                      }}\r\n                    >\r\n                      {assignmentsVisible ? 'Hide Assignments' : 'View Assignments'}\r\n                    </button>\r\n                    <button\r\n                      onClick={() => {\r\n                        setUnlinkTarget({ childId: child.childId, name: child.name });\r\n                        setShowUnlinkModal(true);\r\n                      }}\r\n                      style={{\r\n                        padding: '6px 10px',\r\n                        border: '1px solid #ef4444',\r\n                        background: isDark ? '#0f172a' : 'white',\r\n                        color: isDark ? '#f87171' : '#ef4444',\r\n                        borderRadius: 6,\r\n                        cursor: 'pointer',\r\n                        fontSize: 12\r\n                      }}\r\n                    >\r\n                      Unlink\r\n                    </button>\r\n                  </div>\r\n                )}\r\n\r\n                {assignmentsVisible && (\r\n                  <div\r\n                    style={{\r\n                      marginTop: 8,\r\n                      padding: 8,\r\n                      border: isDark ? '1px solid #334155' : '1px solid #ddd',\r\n                      borderRadius: 6\r\n                    }}\r\n                  >\r\n                    {assignmentsLoading[child.childId] ? (\r\n                      <div style={{ color: isDark ? '#94a3b8' : '#64748b' }}>Loading...</div>\r\n                    ) : assignmentsError[child.childId] ? (\r\n                      <div style={{ color: isDark ? '#fca5a5' : '#991b1b' }}>{assignmentsError[child.childId]}</div>\r\n                    ) : assignments.length === 0 ? (\r\n                      <div style={{ color: isDark ? '#94a3b8' : '#64748b' }}>No active assignments.</div>\r\n                    ) : (\r\n                      <div style={{ display: 'grid', gap: 6 }}>\r\n                        {assignments.map((assignment) => (\r\n                          <div\r\n                            key={assignment.id}\r\n                            style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}\r\n                          >\r\n                            <span style={{ color: isDark ? '#f8fafc' : '#000000' }}>\r\n                              {assignment.title || 'Task'}{' '}\r\n                              <span style={{ color: isDark ? '#94a3b8' : '#64748b' }}>+{assignment.points || 0} pts</span>\r\n                            </span>\r\n                            <button\r\n                              onClick={async () => {\r\n                                await taskAssignmentService.unassign(assignment.id);\r\n                                await loadAssignmentsForChild(child.childId);\r\n                              }}\r\n                              style={{\r\n                                padding: '4px 8px',\r\n                                border: '1px solid #ef4444',\r\n                                color: '#ef4444',\r\n                                background: 'transparent',\r\n                                borderRadius: 4,\r\n                                cursor: 'pointer',\r\n                                fontSize: 12\r\n                              }}\r\n                            >\r\n                              Unassign\r\n                            </button>\r\n                          </div>\r\n                        ))}\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n                )}\r\n              </div>\r\n            );\r\n          })}\r\n        </div>\r\n      )}\r\n      {/* PIN Settings */}\r\n            <div style={{ \r\n              padding: 20, \r\n              border: isDark ? '1px solid #334155' : '1px solid #ddd', \r\n              borderRadius: 8,\r\n              backgroundColor: isDark ? '#1e293b' : 'white'\r\n            }}>\r\n              <h3 style={{ color: isDark ? '#f8fafc' : '#000000' }}>Security</h3>\r\n              <div style={{ marginBottom: 16 }}>\r\n                <label style={{ display: 'block', marginBottom: 8, fontWeight: 'bold', color: isDark ? '#f8fafc' : '#000000' }}>\r\n                  New PIN\r\n                </label>\r\n                <input\r\n                  type=\"password\"\r\n                  value={newPin}\r\n                  onChange={(e) => setNewPin(sanitizePinInput(e.target.value))}\r\n                  placeholder=\"Enter new 4-digit PIN\"\r\n                  maxLength={4}\r\n                  style={{\r\n                    width: '100%',\r\n                    maxWidth: 200,\r\n                    padding: 12,\r\n                    border: isDark ? '1px solid #334155' : '1px solid #ddd',\r\n                    borderRadius: 8,\r\n                    fontSize: 16,\r\n                    backgroundColor: isDark ? '#0f172a' : 'white',\r\n                    color: isDark ? '#f8fafc' : '#000000',\r\n                    boxSizing: 'border-box'\r\n                  }}\r\n                />\r\n              </div>\r\n              \r\n              <div style={{ marginBottom: 16 }}>\r\n                <label style={{ display: 'block', marginBottom: 8, fontWeight: 'bold', color: isDark ? '#f8fafc' : '#000000' }}>\r\n                  Confirm New PIN\r\n                </label>\r\n                <input\r\n                  type=\"password\"\r\n                  value={confirmPin}\r\n                  onChange={(e) => setConfirmPin(sanitizePinInput(e.target.value))}\r\n                  placeholder=\"Confirm new PIN\"\r\n                  maxLength={4}\r\n                  style={{\r\n                    width: '100%',\r\n                    maxWidth: 200,\r\n                    padding: 12,\r\n                    border: isDark ? '1px solid #334155' : '1px solid #ddd',\r\n                    borderRadius: 8,\r\n                    fontSize: 16,\r\n                    backgroundColor: isDark ? '#0f172a' : 'white',\r\n                    color: isDark ? '#f8fafc' : '#000000',\r\n                    boxSizing: 'border-box'\r\n                  }}\r\n                />\r\n              </div>\r\n              \r\n              {pinMessage && (\r\n                <div style={{ \r\n                  marginBottom: 16, \r\n                  padding: 12, \r\n                  backgroundColor: pinMessage.includes('successfully') ? (isDark ? '#065f46' : '#dcfce7') : (isDark ? '#7f1d1d' : '#fee2e2'), \r\n                  border: `1px solid ${pinMessage.includes('successfully') ? (isDark ? '#047857' : '#bbf7d0') : (isDark ? '#b91c1c' : '#fecaca')}`, \r\n                  borderRadius: 8,\r\n                  color: pinMessage.includes('successfully') ? (isDark ? '#6ee7b7' : '#166534') : (isDark ? '#fca5a5' : '#991b1b')\r\n                }}>\r\n                  {pinMessage}\r\n                </div>\r\n              )}\r\n              \r\n              <button\r\n                onClick={handleChangePin}\r\n                style={{\r\n                  padding: '12px 24px',\r\n                  background: isDark ? '#0ea5e9' : '#0ea5e9',\r\n                  color: 'white',\r\n                  border: 'none',\r\n                  borderRadius: 8,\r\n                  cursor: 'pointer',\r\n                  fontWeight: 'bold',\r\n                  fontSize: 16,\r\n                  width: '100%'\r\n                }}\r\n              >\r\n                Change PIN\r\n              </button>\r\n            </div>\r\n            \r\n            {/* Reset Data */}\r\n            <div style={{ \r\n              padding: 20, \r\n              border: isDark ? '1px solid #334155' : '1px solid #ddd', \r\n              borderRadius: 8,\r\n              backgroundColor: isDark ? '#1e293b' : 'white'\r\n            }}>\r\n              <h3 style={{ color: isDark ? '#f8fafc' : '#000000' }}>Danger Zone</h3>\r\n              <div style={{ \r\n                display: 'flex', \r\n                justifyContent: 'space-between', \r\n                alignItems: 'center',\r\n                marginBottom: 16\r\n              }}>\r\n                <div>\r\n                  <div style={{ fontWeight: 'bold', color: isDark ? '#f8fafc' : '#000000' }}>Reset All Data</div>\r\n                  <div style={{ fontSize: 14, color: isDark ? '#94a3b8' : '#64748b' }}>\r\n                    Permanently delete all quests, rewards, and progress\r\n                  </div>\r\n                </div>\r\n                <button\r\n                  onClick={() => {\r\n                    if (window.confirm('Are you sure you want to reset all data? This cannot be undone.')) {\r\n                      localStorage.clear();\r\n                      // Clear IndexedDB databases\r\n                      indexedDB.databases().then(dbs => {\r\n                        dbs.forEach(db => {\r\n                          if (db.name) {\r\n                            indexedDB.deleteDatabase(db.name);\r\n                          }\r\n                        });\r\n                      });\r\n                      window.location.reload();\r\n                    }\r\n                  }}\r\n                  style={{\r\n                    padding: '8px 16px',\r\n                    background: '#ef4444',\r\n                    color: 'white',\r\n                    border: 'none',\r\n                    borderRadius: 4,\r\n                    cursor: 'pointer'\r\n                  }}\r\n                >\r\n                  Reset\r\n                </button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </section>\r\n      )}\r\n      \r\n      {/* Link Child Modal */}\r\n      {showLinkChildModal && (\r\n        <div style={{\r\n          position: 'fixed',\r\n          top: 0,\r\n          left: 0,\r\n          right: 0,\r\n          bottom: 0,\r\n          backgroundColor: 'rgba(0, 0, 0, 0.5)',\r\n          display: 'flex',\r\n          alignItems: 'center',\r\n          justifyContent: 'center',\r\n          zIndex: 1000\r\n        }}>\r\n          <div style={{\r\n            backgroundColor: isDark ? '#0f172a' : 'white',\r\n            padding: 24,\r\n            borderRadius: 8,\r\n            maxWidth: 400,\r\n            width: '90%'\r\n          }}>\r\n            <h3 style={{ \r\n              marginTop: 0, \r\n              color: isDark ? '#f8fafc' : '#000000',\r\n              marginBottom: 20\r\n            }}>\r\n              Link Child App\r\n            </h3>\r\n            \r\n            <div style={{ marginBottom: 16 }}>\r\n              <label style={{ \r\n                display: 'block', \r\n                marginBottom: 8, \r\n                fontWeight: 'bold',\r\n                color: isDark ? '#f8fafc' : '#000000'\r\n              }}>\r\n                Enter 6-digit PIN\r\n              </label>\r\n              <input\r\n                type=\"text\"\r\n                value={pinInput}\r\n                onChange={(e) => {\r\n                  // Only allow digits and limit to 6 characters\r\n                  const value = e.target.value.replace(/\\D/g, '').slice(0, 6);\r\n                  setPinInput(value);\r\n                }}\r\n                placeholder=\"Enter 6-digit PIN\"\r\n                style={{\r\n                  width: '100%',\r\n                  padding: 12,\r\n                  border: isDark ? '1px solid #334155' : '1px solid #ddd',\r\n                  borderRadius: 8,\r\n                  fontSize: 16,\r\n                  backgroundColor: isDark ? '#1e293b' : 'white',\r\n                  color: isDark ? '#f8fafc' : '#000000',\r\n                  boxSizing: 'border-box'\r\n                }}\r\n              />\r\n              {pinError && (\r\n                <div style={{ \r\n                  color: '#ef4444', \r\n                  fontSize: 14, \r\n                  marginTop: 8 \r\n                }}>\r\n                  {pinError}\r\n                </div>\r\n              )}\r\n            </div>\r\n            \r\n            <div style={{ \r\n              display: 'flex', \r\n              gap: 12,\r\n              justifyContent: 'flex-end'\r\n            }}>\r\n              <button\r\n                onClick={() => {\r\n                  setShowLinkChildModal(false);\r\n                  setPinInput('');\r\n                  setPinError('');\r\n                }}\r\n                style={{\r\n                  padding: '8px 16px',\r\n                  background: isDark ? '#334155' : '#e2e8f0',\r\n                  color: isDark ? '#f8fafc' : '#334155',\r\n                  border: 'none',\r\n                  borderRadius: 4,\r\n                  cursor: 'pointer'\r\n                }}\r\n              >\r\n                Cancel\r\n              </button>\r\n              <button\r\n                onClick={handleLinkChildSubmit}\r\n                style={{\r\n                  padding: '8px 16px',\r\n                  background: '#0ea5e9',\r\n                  color: 'white',\r\n                  border: 'none',\r\n                  borderRadius: 4,\r\n                  cursor: 'pointer'\r\n                }}\r\n              >\r\n                Link\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Unlink Confirmation Modal */}\r\n      {showUnlinkModal && unlinkTarget && (\r\n        <div style={{\r\n          position: 'fixed',\r\n          top: 0,\r\n          left: 0,\r\n          right: 0,\r\n          bottom: 0,\r\n          backgroundColor: 'rgba(0, 0, 0, 0.5)',\r\n          display: 'flex',\r\n          alignItems: 'center',\r\n          justifyContent: 'center',\r\n          zIndex: 1100\r\n        }}>\r\n          <div style={{\r\n            backgroundColor: isDark ? '#0f172a' : 'white',\r\n            padding: 24,\r\n            borderRadius: 8,\r\n            maxWidth: 420,\r\n            width: '90%',\r\n            border: isDark ? '1px solid #334155' : '1px solid #e5e7eb'\r\n          }}>\r\n            <h3 style={{ marginTop: 0, color: isDark ? '#f8fafc' : '#000000' }}>Unlink Child?</h3>\r\n            <p style={{ marginTop: 8, color: isDark ? '#cbd5e1' : '#374151' }}>\r\n              Are you sure you want to unlink <strong>{unlinkTarget.name}</strong>? You can re-link later with a new code.\r\n            </p>\r\n            <div style={{ display: 'flex', justifyContent: 'flex-end', gap: 8, marginTop: 16 }}>\r\n              <button\r\n                onClick={() => {\r\n                  setShowUnlinkModal(false);\r\n                  setUnlinkTarget(null);\r\n                }}\r\n                style={{\r\n                  padding: '8px 12px',\r\n                  background: isDark ? '#334155' : '#e2e8f0',\r\n                  color: isDark ? '#f8fafc' : '#111827',\r\n                  border: 'none',\r\n                  borderRadius: 6,\r\n                  cursor: 'pointer'\r\n                }}\r\n              >\r\n                Cancel\r\n              </button>\r\n              <button\r\n                onClick={async () => {\r\n                  if (unlinkTarget) {\r\n                    try {\r\n                      if (hero) {\r\n                        await linkingService.unlinkAsync(hero.id, unlinkTarget.childId);\r\n                      }\r\n                      await unlinkChild(unlinkTarget.childId);\r\n                    } finally {\r\n                      setShowUnlinkModal(false);\r\n                      setUnlinkTarget(null);\r\n                      setLinkRefresh((x) => x + 1);\r\n                    }\r\n                  }\r\n                }}\r\n                style={{\r\n                  padding: '8px 12px',\r\n                  background: '#ef4444',\r\n                  color: 'white',\r\n                  border: 'none',\r\n                  borderRadius: 6,\r\n                  cursor: 'pointer'\r\n                }}\r\n              >\r\n                Unlink\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Link Request Toast */}\r\n      {currentToast && (\r\n        <LinkRequestToast\r\n          childId={currentToast.childId}\r\n          onApprove={async () => {\r\n            await approvePendingLink(currentToast.id);\r\n            setCurrentToast(null);\r\n          }}\r\n          onDecline={async () => {\r\n            await declinePendingLink(currentToast.id);\r\n            setCurrentToast(null);\r\n          }}\r\n          onClose={closeCurrentToast}\r\n          isDarkMode={isDark}\n        />\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ParentMode;\r\n\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\ColeS\\Documents\\Python_Scripts\\Sibling_Helper\\parent-app\\src\\pages\\RewardShop.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\ColeS\\Documents\\Python_Scripts\\Sibling_Helper\\parent-app\\src\\pages\\Settings.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\ColeS\\Documents\\Python_Scripts\\Sibling_Helper\\parent-app\\src\\pages\\Tasks.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":156,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":156,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5216,5219],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5216,5219],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":371,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":371,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13859,13862],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13859,13862],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useMemo } from 'react';\nimport { useQuests } from '@state/quests';\r\nimport { useHero } from '@state/hero';\r\nimport { useLinkedChildren } from '@state/linkedChildren';\r\nimport { taskAssignmentService } from '@sibling-helper/shared';\r\nimport QuestForm from '@components/QuestForm';\r\nimport type { Quest } from '@state/questTypes';\r\n\r\nconst Tasks = ({ isDarkMode }: { isDarkMode: boolean }) => {\n  const { quests, addQuest, updateQuest, deleteQuest } = useQuests();\r\n  const { hero } = useHero();\r\n  const { linkedChildren } = useLinkedChildren();\r\n  const [editingQuest, setEditingQuest] = useState<string | null>(null);\r\n  const [showAddModal, setShowAddModal] = useState(false);\r\n  const [filter, setFilter] = useState<'all' | 'quests' | 'chores'>('all');\r\n  const [sort, setSort] = useState<'recent' | 'points' | 'az' | 'za'>('recent');\r\n  const [search, setSearch] = useState('');\r\n  const [assignQuestId, setAssignQuestId] = useState<string | null>(null);\r\n  const [assignError, setAssignError] = useState('');\r\n\r\n  // Filter and sort quests\r\n  const filteredAndSortedQuests = useMemo(() => {\n    let result = [...quests];\r\n    \r\n    // Apply filter\r\n    if (filter === 'quests') {\r\n      result = result.filter(q => !q.recurrence || q.recurrence.type === 'none');\r\n    } else if (filter === 'chores') {\r\n      result = result.filter(q => q.recurrence && q.recurrence.type !== 'none');\r\n    }\r\n    \r\n    // Apply search\r\n    if (search) {\r\n      const searchTerm = search.toLowerCase();\r\n      result = result.filter(q => \r\n        q.title.toLowerCase().includes(searchTerm) || \r\n        (q.description && q.description.toLowerCase().includes(searchTerm))\r\n      );\r\n    }\r\n    \r\n    // Apply sort\r\n    result.sort((a, b) => {\r\n      if (sort === 'points') {\r\n        return b.points - a.points;\r\n      } else if (sort === 'az') {\r\n        return a.title.localeCompare(b.title);\r\n      } else if (sort === 'za') {\r\n        return b.title.localeCompare(a.title);\r\n      } else {\r\n        // recent (default) - sort by updated_at, newest first\r\n        return new Date(b.updated_at).getTime() - new Date(a.updated_at).getTime();\r\n      }\r\n    });\r\n    \r\n    return result;\r\n  }, [quests, filter, sort, search]);\r\n\r\n  const handleEditQuest = (id: string) => {\r\n    setEditingQuest(id);\r\n    setShowAddModal(true);\r\n  };\r\n\r\n  const handleCancelEdit = () => {\r\n    setEditingQuest(null);\r\n    setShowAddModal(false);\r\n  };\r\n\r\n  const taskType = (quest: Quest): 'quest' | 'chore' => {\r\n    return quest.recurrence && quest.recurrence.type !== 'none' ? 'chore' : 'quest';\r\n  };\r\n\r\n  return (\r\n    <section>\r\n      <div style={{ \r\n        display: 'flex', \r\n        justifyContent: 'space-between', \r\n        alignItems: 'center',\r\n        marginBottom: 24\r\n      }}>\r\n        <h2 style={{ color: isDarkMode ? '#f8fafc' : '#000000', margin: 0 }}>\r\n          Tasks\r\n        </h2>\r\n        <button\r\n          onClick={() => setShowAddModal(true)}\r\n          style={{\r\n            padding: '8px 16px',\r\n            background: '#0ea5e9',\r\n            color: 'white',\r\n            border: 'none',\r\n            borderRadius: 8,\r\n            cursor: 'pointer',\r\n            fontWeight: 'bold',\r\n            fontSize: 14\r\n          }}\r\n        >\r\n          Add Task\r\n        </button>\r\n      </div>\r\n\r\n      {/* Controls */}\r\n      <div style={{ \r\n        display: 'flex', \r\n        gap: 16, \r\n        marginBottom: 24,\r\n        flexWrap: 'wrap'\r\n      }}>\r\n        {/* Filter */}\r\n        <div style={{ display: 'flex', gap: 4, flexWrap: 'wrap' }}>\r\n          <button\r\n            onClick={() => setFilter('all')}\r\n            style={{\r\n              padding: '6px 12px',\r\n              background: filter === 'all' ? '#0ea5e9' : (isDarkMode ? '#334155' : '#e2e8f0'),\r\n              color: filter === 'all' ? 'white' : (isDarkMode ? '#cbd5e1' : '#334155'),\r\n              border: 'none',\r\n              borderRadius: 6,\r\n              cursor: 'pointer',\r\n              fontSize: 14\r\n            }}\r\n          >\r\n            All\r\n          </button>\r\n          <button\r\n            onClick={() => setFilter('quests')}\r\n            style={{\r\n              padding: '6px 12px',\r\n              background: filter === 'quests' ? '#0ea5e9' : (isDarkMode ? '#334155' : '#e2e8f0'),\r\n              color: filter === 'quests' ? 'white' : (isDarkMode ? '#cbd5e1' : '#334155'),\r\n              border: 'none',\r\n              borderRadius: 6,\r\n              cursor: 'pointer',\r\n              fontSize: 14\r\n            }}\r\n          >\r\n            Quests\r\n          </button>\r\n          <button\r\n            onClick={() => setFilter('chores')}\r\n            style={{\r\n              padding: '6px 12px',\r\n              background: filter === 'chores' ? '#0ea5e9' : (isDarkMode ? '#334155' : '#e2e8f0'),\r\n              color: filter === 'chores' ? 'white' : (isDarkMode ? '#cbd5e1' : '#334155'),\r\n              border: 'none',\r\n              borderRadius: 6,\r\n              cursor: 'pointer',\r\n              fontSize: 14\r\n            }}\r\n          >\r\n            Chores\r\n          </button>\r\n        </div>\r\n\r\n        {/* Sort */}\r\n        <select\r\n          value={sort}\r\n          onChange={(e) => setSort(e.target.value as any)}\r\n          style={{\r\n            padding: '6px 12px',\r\n            border: isDarkMode ? '1px solid #334155' : '1px solid #ddd',\r\n            borderRadius: 6,\r\n            background: isDarkMode ? '#0f172a' : 'white',\r\n            color: isDarkMode ? '#f8fafc' : '#000000'\r\n          }}\r\n        >\r\n          <option value=\"recent\">Recently updated</option>\r\n          <option value=\"points\">Points</option>\r\n          <option value=\"az\">A-Z</option>\r\n          <option value=\"za\">Z-A</option>\r\n        </select>\r\n\r\n        {/* Search */}\r\n        <input\r\n          type=\"text\"\r\n          placeholder=\"Search tasks\"\r\n          value={search}\r\n          onChange={(e) => setSearch(e.target.value)}\r\n          style={{\r\n            padding: '6px 12px',\r\n            border: isDarkMode ? '1px solid #334155' : '1px solid #ddd',\r\n            borderRadius: 6,\r\n            background: isDarkMode ? '#0f172a' : 'white',\r\n            color: isDarkMode ? '#f8fafc' : '#000000',\r\n            minWidth: 150\r\n          }}\r\n        />\r\n      </div>\r\n\r\n      {/* Task List */}\r\n      <div style={{ display: 'grid', gridTemplateColumns: '1fr', gap: 12 }}>\r\n        {filteredAndSortedQuests.length === 0 ? (\r\n          <div style={{ \r\n            textAlign: 'center', \r\n            padding: 32, \r\n            color: isDarkMode ? '#94a3b8' : '#64748b' \r\n          }}>\r\n            No tasks yet. Create your first one.\r\n          </div>\r\n        ) : (\r\n          filteredAndSortedQuests.map(quest => (\r\n            <div \r\n              key={quest.id} \r\n              style={{ \r\n                padding: 16, \r\n                border: isDarkMode ? '1px solid #334155' : '1px solid #ddd', \r\n                borderRadius: 8,\r\n                display: 'flex',\r\n                justifyContent: 'space-between',\r\n                alignItems: 'center',\r\n                backgroundColor: isDarkMode ? '#1e293b' : 'white'\r\n              }}\r\n            >\r\n              <div>\r\n                <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>\r\n                  <strong style={{ color: isDarkMode ? '#f8fafc' : '#000000' }}>\r\n                    {quest.title}\r\n                  </strong>\r\n                  <span style={{\r\n                    padding: '2px 6px',\r\n                    borderRadius: 4,\r\n                    fontSize: 12,\r\n                    fontWeight: 'bold',\r\n                    backgroundColor: taskType(quest) === 'chore' ? '#f0f9ff' : '#f0fdf4',\r\n                    color: taskType(quest) === 'chore' ? '#0ea5e9' : '#16a34a',\r\n                    border: `1px solid ${taskType(quest) === 'chore' ? '#bae6fd' : '#bbf7d0'}`\r\n                  }}>\r\n                    {taskType(quest) === 'chore' ? 'Chore' : 'Quest'}\r\n                  </span>\r\n                </div>\r\n                <div style={{ color: isDarkMode ? '#94a3b8' : '#64748b', marginTop: 4 }}>\r\n                  +{quest.points} pts\r\n                  {quest.recurrence && quest.recurrence.type !== 'none' && (\r\n                    <span> - Recurring ({quest.recurrence.type})</span>\r\n                  )}\r\n                  {quest.category && (\r\n                    <span> - {quest.category}</span>\r\n                  )}\r\n                </div>\r\n                {quest.description && (\r\n                  <div style={{ color: isDarkMode ? '#cbd5e1' : '#334155', marginTop: 4, fontSize: 14 }}>\r\n                    {quest.description}\r\n                  </div>\r\n                )}\r\n              </div>\r\n              <div style={{ display: 'flex', gap: 8 }}>\r\n                <button\r\n                  onClick={() => handleEditQuest(quest.id)}\r\n                  style={{\r\n                    padding: '4px 8px',\r\n                    border: isDarkMode ? '1px solid #0ea5e9' : '1px solid #0ea5e9',\r\n                    background: isDarkMode ? '#0f172a' : 'white',\r\n                    color: isDarkMode ? '#38bdf8' : '#0ea5e9',\r\n                    borderRadius: 4,\r\n                    cursor: 'pointer'\r\n                  }}\r\n                >\r\n                  Edit\r\n                </button>\r\n                <button\r\n                  onClick={() => { setAssignQuestId(quest.id); setAssignError(''); }}\r\n                  style={{\r\n                    padding: '4px 8px',\r\n                    border: isDarkMode ? '1px solid #16a34a' : '1px solid #16a34a',\r\n                    background: isDarkMode ? '#0f172a' : 'white',\r\n                    color: isDarkMode ? '#86efac' : '#16a34a',\r\n                    borderRadius: 4,\r\n                    cursor: 'pointer'\r\n                  }}\r\n                >\r\n                  Assign\r\n                </button>\r\n                <button\r\n                  onClick={() => deleteQuest(quest.id)}\r\n                  style={{\r\n                    padding: '4px 8px',\r\n                    border: isDarkMode ? '1px solid #ef4444' : '1px solid #ef4444',\r\n                    background: isDarkMode ? '#0f172a' : 'white',\r\n                    color: isDarkMode ? '#f87171' : '#ef4444',\r\n                    borderRadius: 4,\r\n                    cursor: 'pointer'\r\n                  }}\r\n                >\r\n                  Delete\r\n                </button>\r\n              </div>\r\n            </div>\r\n          ))\r\n        )}\r\n      </div>\r\n\r\n      {/* Add/Edit Modal */}\r\n      {(showAddModal || editingQuest) && (\r\n        <div style={{\r\n          position: 'fixed',\r\n          top: 0,\r\n          left: 0,\r\n          right: 0,\r\n          bottom: 0,\r\n          backgroundColor: 'rgba(0, 0, 0, 0.5)',\r\n          display: 'flex',\r\n          alignItems: 'center',\r\n          justifyContent: 'center',\r\n          zIndex: 1000\r\n        }}>\r\n          <div style={{\r\n            backgroundColor: isDarkMode ? '#0f172a' : 'white',\r\n            padding: 24,\r\n            borderRadius: 8,\r\n            maxWidth: 500,\r\n            width: '90%',\r\n            maxHeight: '90vh',\r\n            overflowY: 'auto'\r\n          }}>\r\n            <h3 style={{ \r\n              marginTop: 0, \r\n              color: isDarkMode ? '#f8fafc' : '#000000',\r\n              marginBottom: 20\r\n            }}>\r\n              {editingQuest ? 'Edit Task' : 'Add Task'}\r\n            </h3>\r\n            \r\n            <QuestForm \r\n              quest={editingQuest ? quests.find(q => q.id === editingQuest) : undefined}\r\n              onSave={async (questData) => {\r\n                if (editingQuest) {\r\n                  await updateQuest(editingQuest, questData);\r\n                } else {\r\n                  await addQuest(questData);\r\n                }\r\n                handleCancelEdit();\r\n              }}\r\n              onCancel={handleCancelEdit}\r\n            />\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Assign Modal */}\r\n      {assignQuestId && (\r\n        <div style={{\r\n          position: 'fixed', top: 0, left: 0, right: 0, bottom: 0,\r\n          backgroundColor: 'rgba(0,0,0,0.5)', display: 'flex', alignItems: 'center', justifyContent: 'center', zIndex: 1000\r\n        }}>\r\n          <div style={{\r\n            backgroundColor: isDarkMode ? '#0f172a' : 'white', padding: 24, borderRadius: 8, width: '90%', maxWidth: 420,\r\n            border: isDarkMode ? '1px solid #334155' : '1px solid #ddd'\r\n          }}>\r\n            <h3 style={{ marginTop: 0, color: isDarkMode ? '#f8fafc' : '#000000' }}>Assign Task</h3>\r\n            <p style={{ color: isDarkMode ? '#cbd5e1' : '#374151' }}>Choose a child to assign this task to.</p>\r\n            {assignError && (\r\n              <div style={{ marginBottom: 8, color: isDarkMode ? '#fca5a5' : '#991b1b' }}>{assignError}</div>\r\n            )}\r\n            <div style={{ display: 'grid', gap: 8, maxHeight: 240, overflowY: 'auto' }}>\r\n              {linkedChildren.length === 0 && (\r\n                <div style={{ color: isDarkMode ? '#94a3b8' : '#64748b' }}>No linked children. Link a child in Settings.</div>\r\n              )}\r\n              {linkedChildren.map((c) => (\r\n                <button key={c.childId}\r\n                  onClick={async () => {\r\n                    try {\r\n                      setAssignError('');\r\n                      if (!hero) throw new Error('Parent profile not ready');\r\n                      const q = quests.find(q => q.id === assignQuestId);\r\n                      await taskAssignmentService.assign({\r\n                        parentId: hero.id,\r\n                        childId: c.childId,\r\n                        questId: assignQuestId!,\r\n                        title: q?.title || 'Task',\r\n                        points: q?.points || 0,\r\n                      });\r\n                      setAssignQuestId(null);\r\n                    } catch (e: any) {\r\n                      setAssignError(e?.message || 'Failed to assign');\r\n                    }\r\n                  }}\r\n                  style={{\r\n                    display: 'flex', justifyContent: 'space-between', alignItems: 'center',\r\n                    padding: '10px 12px', borderRadius: 8,\r\n                    border: isDarkMode ? '1px solid #334155' : '1px solid #ddd',\r\n                    background: isDarkMode ? '#1e293b' : 'white', cursor: 'pointer'\r\n                  }}\r\n                >\r\n                  <span style={{ color: isDarkMode ? '#f8fafc' : '#000000' }}>{c.name}</span>\r\n                  <span style={{ fontSize: 12, color: isDarkMode ? '#94a3b8' : '#64748b' }}>Tap to assign</span>\r\n                </button>\r\n              ))}\r\n            </div>\r\n            <div style={{ display: 'flex', justifyContent: 'flex-end', marginTop: 12 }}>\r\n              <button onClick={() => setAssignQuestId(null)}\r\n                style={{ padding: '8px 12px', background: isDarkMode ? '#334155' : '#e2e8f0', color: isDarkMode ? '#f8fafc' : '#111827', border: 'none', borderRadius: 6, cursor: 'pointer' }}>\r\n                Close\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </section>\r\n  );\r\n};\r\n\r\nexport default Tasks;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]}]